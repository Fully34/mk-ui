!function(t,e){if("function"==typeof define&&define.amd)define(["mk"],function(i){return e(t,i)});else{if("object"!=typeof module||!module.exports)return e(t,t.Mk);module.exports=e(t,require("mk"))}}("undefined"!=typeof window?window:this,function(t,e){var i={"left-center":function(t,e){return{left:e.left-t.width-t.box.left-t.box.right,top:e.top+e.height/2-t.height/2-t.box.top}},"left-top":function(t,e){return{left:e.left-t.width-t.box.left-t.box.right,top:e.top-t.box.top}},"left-bottom":function(t,e){return{left:e.left-t.width-t.box.left-t.box.right,top:e.top+e.height-t.height-t.box.top}},"right-center":function(t,e){return{left:e.left+e.width,top:e.top+e.height/2-t.height/2-t.box.top}},"right-top":function(t,e){return{left:e.left+e.width,top:e.top-t.box.top}},"right-bottom":function(t,e){return{left:e.left+e.width,top:e.top+e.height-t.height-t.box.top}},"top-left":function(t,e){return{left:e.left-t.box.left,top:e.top-t.height-(t.box.bottom+t.box.top)}},"top-center":function(t,e){return{left:e.left+e.width/2-t.width/2-t.box.left,top:e.top-t.height-(t.box.bottom+t.box.top)}},"top-right":function(t,e){return{left:e.left+e.width-t.width-t.box.right,top:e.top-t.height-(t.box.bottom+t.box.top)}},"bottom-left":function(t,e){return{left:e.left-t.box.left,top:e.top+e.height}},"bottom-center":function(t,e){return{left:e.left+e.width/2-t.width/2-t.box.left,top:e.top+e.height}},"bottom-right":function(t,e){return{left:e.left+e.width-t.width-t.box.right,top:e.top+e.height}}};return e.create("Tooltip",{name:"mk-tt",relexp:/^relative|absolute|fixed$/i,templates:{modal:'<span class="{{$key}}-modal">{{html}}</span>',kill:'<button class="{{$key}}-kill" role="presentation"></button>'},get map(){return i},_config:function(t){return this.config.map={},this.each(this.map,function(t,e){this.config.map[t]=e}),t=t||{},t.position=t.position||"top-center",t.delay=parseInt(t.delay||"200",10)||200,this.super(t)},_bind:function(){var t=this,e=this.selector();this.selector("modal");this.root.on("click.mk",e,function(e){e.preventDefault(),t._click(this)}).on("mouseenter.mk, focus.mk",e,function(e){e.preventDefault(),t._over(this,"mouseenter"!==e.type)}).on("mouseleave.mk, blur.mk",e,function(e){e.preventDefault(),t._out(this,"mouseleave"!==e.type)}).on("keyup.mk",e,function(e){t._keyup(e,this)}),this.$(document.documentElement).off("mousedown"+e).on("mousedown"+e,function(e){t._down(e)})},_down:function(t){var e=this.$(t.target),i=this.selector(),o=this.selector("modal");return!(e.is(i)||e.closest(i).length>0||e.is(o)||e.closest(o).length>0)&&this.hideAll()},_keyup:function(t,e){t.which===this.keycode.esc&&this._unlock(e).hide(e)},_click:function(t){var e=this.$(t);"click"===e.data("action")&&this.toggle(t)},_over:function(t,e){var i=this.$(t);"click"!==i.data("action")&&(this.show(t),e===!0&&this.isFocusable(this.modal(t))&&this._lock(t))},_out:function(t,e){var i=this.$(t);"click"!==i.data("action")&&(e!==!0&&this.isFocusable(this.modal(t))&&this._unlock(t),this.hide(t))},_lock:function(t){return this.$(t).addClass("--locked"),this},_unlock:function(t){return this.$(t).removeClass("--locked"),this},_locked:function(t){return this.$(t).hasClass("--locked")},_unlocked:function(t){return this.$(t).hasClass("--locked")!==!0},_relativePosition:function(t,e,i){var o,n={left:e,top:i};return t.relativeParent&&(o=this.offset(t.relativeParent),n.left=e+o.left,n.top=i+o.top,o.relativeParent)?this._relativePosition(o,n.left,n.top):n},_position:function(t,e,i,o,n){if(t=t.toLowerCase(),n=n||0,n<5){var s=this.config.map.hasOwnProperty(t)&&this.config.map[t]||null;if(s){var r,l=s(e,i),h=t,a=l.left,f=l.top;return i.relativeParent&&(r=this._relativePosition(i,a,f),a=r.left+l.left,f=r.top+l.top-o.scroll),a<o.left?h=/^left/i.test(t)&&h.replace(/left/,"right")||h.replace(/center/,"left"):a>o.width&&(h=/^right/.test(t)&&h.replace(/right/,"left")||h.replace(/center/,"right")),f<o.top?h=h.replace(/top/,"bottom"):f>o.height&&(h=h.replace(/bottom/,"top")),h!==t?this._position(h,e,i,o,n++):(l.key=t,l)}}return null},isFocusable:function(t){var e=this.$("a, button, input, select, textarea, table, iframe",t).length>0;return e!==!0&&this.each(this.$("[tabindex]",t),function(t,i){if(i.tabindex>-1)return e=!0,!1}),e},link:function(t){var e,i=this.$(t),o=this.$("#"+i.attr("aria-describedby"));if(o.length<1){var n=this.uid(),s=i.attr("aria-label");s?(o=this.html("modal",{html:s}).appendTo(i),i.attr("aria-label","")):(o=i.find(this.selector("modal")),o.length<1&&(o=i.parent().find(this.selector("modal"))),n=o.attr("id")||n),o.attr("id",n)}return e=o.attr("aria-hidden"),e||o.attr("aria-hidden","true"),this.connect(i,o)},connect:function(t,e){var i=this.$(t),o=this.$(e),n=i.attr("id"),s="tooltip";return o.data(this.name+"-connected")?this:(this.isFocusable(e)&&(s="dialog",n||(n=this.uid(),i.attr("id",n)),o.attr("aria-labelledby",n)),o.attr("role",s),i.attr("aria-describedby",o.attr("id")),this.transitions&&o.addClass("transitions"),o.data(this.name+"-connected",!0),this.emit("connect",i,o),this)},box:function(t){var e=this.$(t)[0],i={top:0,left:0,right:0,bottom:0};if(e){var o=getComputedStyle(e);this.each(i,function(t,e){i[t]=parseFloat(o.getPropertyValue("margin-"+t),10)+parseFloat(o.getPropertyValue("border-"+t+"-width"),10)})}return i},offset:function(t,e){var i,o=this.$(t)[0],n=this.relexp,s={left:0,top:0,width:0,height:0,box:this.box(o)};if(o)for(s.left=o.offsetLeft,s.top=o.offsetTop,s.width=o.offsetWidth,s.height=o.offsetHeight;o=o.offsetParent;)i=getComputedStyle(o),n.test(i.getPropertyValue("position"))!==!0?(s.left+=o.offsetLeft,s.top+=o.offsetTop):s.relativeParent=o;return s},frame:function(t){var e=this.$(t)[0];if(e){for(;e.scrollTop<=0&&"BODY"!==e.tagName;)e=e.parentNode;return{node:e,top:t.scrollTop,left:t.scrollLeft,scroll:t.scrollTop,width:t.offsetWidth,height:t.offsetHeight}}return{node:null}},position:function(t,e){var i=this.$(e),o=i.attr("data-position")||this.config.position,n=this._position(o,this.offset(t,!0),this.offset(e),this.frame(t));if(n){var s=this.$(t);this.each(this.config.map,function(t){s.removeClass(t)}),s.addClass(n.key),this.emit("position",i,s,n),s.css({left:n.left,top:n.top})}return this},modal:function(t){var e,i=this.$(t),o=i.attr("aria-describedby")||"";return""===o&&(this.link(t),o=i.attr("aria-describedby")||""),o&&(o="#"+o),e=this.$(o),this.connect(i,e),e},focus:function(t,e){var i=this.$(e),o=i.find(this.selector("kill"));return o.length<1&&(o=this.html("kill"),o.on("focus.mk",function(){t.focus()}),i.append(o)),this},show:function(t){var e,i=this.$(t);return this._unlocked(i)&&this.unlocked(i)&&(this.hideAll(),e=this.modal(t),this.transition(e,function(t,e){e.removeClass("in")}).delay(function(){e.addClass("in"),e.attr("aria-hidden","false"),this.position(e,t),this.isFocusable(e)&&this.focus(i,e),this.emit("show",i,e)})),this},hide:function(t,e){var i,o,n=this.$(t),s=n.attr("data-action");return this._unlocked(n)&&this.unlocked(n)&&(i=this.modal(t),o=e!==!0&&"click"!==s&&this.isFocusable(i)&&this.config.delay||0,this.transition(i,function(t,e){e.removeClass("out")}).delay(function(){i.addClass("out"),i.attr("aria-hidden","true"),(e||this.transitions!==!0)&&(i.removeClass("out"),this.clearTransitions(i)),this.emit("hide",n,i)},o)),this},hideAll:function(){var t,e=this.$(this.selector("modal")).filter('[aria-hidden="false"]'),i=this.$(this.selector(),this.element);return this.each(e,function(e,o){t=i.filter('[aria-describedby="'+o.id+'"]'),this._unlock(t).hide(t,!0)})},toggle:function(t){var e=this.modal(t),i="false"===e.attr("aria-hidden");return i?this.hide(t):this.show(t)},isOpen:function(t){return"true"!==this.modal(t).attr("aria-hidden")},isHidden:function(t){return"false"!==this.modal(t).attr("aria-hidden")},lock:function(t){var e=this.$(t);return e.hasClass(this.name)&&!e.hasClass("locked")&&(e.addClass("locked"),this.emit("lock",e,!0)),this},unlock:function(t){var e=this.$(t);return e.hasClass(this.name)&&e.hasClass("locked")&&(e.removeClass("locked"),this.emit("lock",e,!1)),this},locked:function(t){return this.$(t).hasClass("locked")},unlocked:function(t){return this.$(t).hasClass("locked")!==!0}}),e.get("Tooltip")});