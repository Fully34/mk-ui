!function(t,e){if("function"==typeof define&&define.amd)define(["mk"],function(i){return e(t,i)});else{if("object"!=typeof module||!module.exports)return e(t,t.Mk);module.exports=e(t,require("mk"))}}("undefined"!=typeof window?window:this,function(t,e){return e.create("Selectmenu",{name:"mk-sm",templates:{shadow:'<div class="{{$key}}-shadow{{if:classname}} {{classname}}{{/if:classname}}">\t\t\t\t\t{{template:trigger}}\t\t\t\t\t{{scope:list}}\t\t\t\t\t\t{{template:list}}\t\t\t\t\t{{/scope:list}}\t\t\t\t<div />',trigger:'<div class="{{$key}}-trigger {{if:disabled}} disabled{{/if:disabled}}" role="combobox" aria-haspopup="listbox">\t\t\t\t\t<input type="text" \t\t\t\t\t\tclass="{{$key}}-input" \t\t\t\t\t\treadonly \t\t\t\t\t\taria-autocomplete="list" \t\t\t\t\t\taria-readonly="true" \t\t\t\t\t\taria-disabled="{{disabled}}" \t\t\t\t\t\t{{if:multiple}}aria-multiselectable="true" {{/if:multiple}} \t\t\t\t\t\tvalue="{{label}}" /> \t\t\t\t</div>',list:'<ul id="{{id}}" class="{{$key}}-list" role="listbox">\t\t\t\t\t{{loop:items}}\t\t\t\t\t\t{{template:item}}\t\t\t\t\t{{/loop:items}}\t\t\t\t</ul>',item:'<li class="{{$key}}-item" data-level="{{level}}" role="presentation">\t\t\t\t\t{{template:option}}\t\t\t\t</li>',option:'<a id="{{id}}" \t\t\t\t\tclass="{{$key}}-{{tagname}}{{if:classname}} {{classname}}{{/if:classname}}" \t\t\t\t\trole="{{role}}" \t\t\t\t\thref="javascript: void(0);" \t\t\t\t\taria-selected="{{selected}}" \t\t\t\t\taria-disabled="{{disabled}}" \t\t\t\t\tdata-value="{{value}}">\t\t\t\t\t<span class="{{$key}}-label">\t\t\t\t\t\t{{label}}\t\t\t\t\t</span>\t\t\t\t\t<span class="{{$key}}-alt">{{alt}}</span>\t\t\t\t</a>',removable:'<option class="{{$key}}-removable" value="{{value}}" data-alt="{{alt}}">{{label}}</option>'},formats:{label:"Combobox",removable:"Clear",removableAlt:"{{if:selected}}<span>({{selected}} of {{total}})</span>{{/if:selected}}"},get selectmenu(){return this.node("",this.root)},get element(){return this.selectmenu[0]},get version(){return"v1.0.0"},get multiple(){return this.element.multiple},get disabled(){return this.element.disabled},get enabled(){return this.element.disabled!==!0},get options(){return this.element.options||[]},get trigger(){return this.node("trigger",this.shadow)},get input(){return this.node("input",this.shadow)},get list(){return this.node("list",this.shadow)},get items(){return this.list.find(this.selector("item"))},get listOptions(){return this.list.find('[role="option"]')},get isHidden(){return"true"!==this.trigger.attr("aria-expanded")},get isOpen(){return"true"===this.trigger.attr("aria-expanded")},get value(){if(this.multiple){var t=[];return this.each(this.options,function(e,i){i.selected&&t.push(i.value)}),t}return this.element.value},_verifyTag:function(t){var e=this.node("",t);if(e.length<1||"select"!==e[0].tagName.toLowerCase())throw new Error(":: Mk.Selectmenu - root must have a <select> node ::");return!0},_define:function(t,e){this._verifyTag(t)&&this.super(t,e)},_config:function(t){t=t||{};var e=this.selectmenu.attr("aria-label")||this.formats.label;this._param("label","string",t,e,this.selectmenu),this.multiple&&(this._param("removable","boolean",t,!1,this.selectmenu),this._param("removableId","string",t,this.uid())),this.super(t)},_label:function(){var t=this.element.id,e=this.$('label[for="'+t+'"]');e.length?e.attr("for",this.input.attr("id")):this.input.attr("aria-label",this.selectmenu.attr("aria-label"))},_build:function(){this.config.removable&&this._buildRemovable(),this.shadow=this.html("shadow",this.data()).appendTo(this.root),this.transitions&&this.shadow.addClass("transitions");var t=this.list,e=t.find('[aria-selected="true"]');this.trigger.attr({"aria-controls":t.attr("id")||"","aria-activedescendant":e.attr("id")||""}),this.input.attr("id",this.uid()),this.selectmenu.attr("aria-hidden","true"),this._label()},_buildRemovable:function(){this.html("removable",{label:this.format("removable"),value:this.config.removableId,alt:this._getRemovableAlt()}).appendTo(this.element)},_getRemovableAlt:function(){return this.multiple&&this.value.length>0?this.format("removableAlt",{selected:this.value.length,total:this.options.length}):""},_updateRemovableAlt:function(){if(this.config.removable){var t=this._getRemovableAlt();this.$(this.options).filter(this.selector("removable")).attr("data-alt",t),this.items.find(this.selector("removable")).find(this.selector("alt")).html(t)}return this},_bind:function(){this._bindInputEvents(),this._bindListEvents(),this._bindListItemEvents()},_bindInputEvents:function(){var t=this,e=this.trigger,i=!1,s=!1;this.input.on("focus.mk",function(a){t.disabled||(s&&(s=!1,t.toggle()),e.addClass("focus"),i=!0)}).on("blur.mk",function(e){this.disabled||(i=!1,t.blur())}).on("mousedown.mk",function(e){s=!0,i&&(s=!1,t.toggle())}).on("keydown.mk",function(e){t._keydown(e)}).on("keypress.mk",function(e){e.preventDefault(),t.search(String.fromCharCode(e.which),!0)})},_bindListEvents:function(){var t=this;this.list.on("mousedown.mk",function(t){t.preventDefault()}).on("click.mk",'[role="option"]',function(e){e.preventDefault(),t.transitioning(t.list)||t.select(this.getAttribute("data-value"))})},_bindListItemEvents:function(){var t=this;this.list.find('[role="option"]').on("mouseenter.mk",function(e){t.transitioning(t.list)||t.activate(this)})},_keydown:function(t){if(!this.disabled){var e=t.which,i=this.keycode;switch(e){case i.enter:this._enter(t);break;case i.space:this._space(t);break;case i.esc:this._esc(t);break;case i.up:case i.down:t.preventDefault(),this.move(e===i.up);break;case i.tab:this._tab(t)}}},_enter:function(t){if(t.preventDefault(),this.isHidden)return this.show();var e=this.items.find(".active"),i=e.attr("data-value");return"true"!==e.attr("aria-selected")?this.select(i):this.multiple&&this.deselect(i),this.multiple!==!0?this.hide():void 0},_space:function(t){return t.preventDefault(),this.isHidden?this.show():this._enter(t)},_esc:function(t){return t.preventDefault(),this.isOpen&&this.hide(),this},_tab:function(t){if(this.isOpen){t.preventDefault();var e=this.items.find(".active");this.multiple!==!0&&e.length&&"true"!==e.attr("aria-selected")&&this.select(e.attr("data-value")),this.hide()}},blur:function(){if(this.disabled)return this.hide();var t=this.trigger;if(t.removeClass("focus"),this.isHidden){var e=this.items.find(".active");e.length&&"true"!==e.attr("aria-selected")&&this.select(e.attr("data-value"))}return this.updateLabel().hide()},move:function(t){var e,i=this.items,s=this.items.find(".active")[0],a=this.listOptions,n=!1;if("undefined"==typeof s&&(s=i.find('[aria-selected="true"]')[0],"undefined"==typeof s&&(s=a[0],n=!0),this.activate(s)),n)e=s,s=null;else{var l=t&&-1||1;for(index=this.index(s)+l,e=a[index];e&&"true"===e.getAttribute("aria-disabled");)index+=l,e=a[index];"undefined"==typeof e&&(e=t&&a[0]||a[a.length-1])}e!==s&&(this.activate(e,!0),this.scrollTo(e,t))},search:function(t,e){if(this.disabled!==!0&&t){this._timer&&(clearTimeout(this._timer),this._timer=null),this.query=this.query||"",e?this.query+=t:this.query=t;var i=this.getElementByLabel(this.query),s=this;i&&this.activate(i,!0),this._timer=setTimeout(function(){s.query="",s._timer=null},500)}},index:function(t){var e=0;return this.each(this.listOptions,function(i,s){if(s===t)return e=i,!1}),e},getOptgroupValue:function(t){var e=t.children||[],i=[];return this.each(e,function(t,e){i.push(e.value)}),i.join("|||")},getElementByLabel:function(t){var e,i=this.selector("label"),s=new RegExp("^"+t,"i"),a=null;return this.each(this.listOptions,function(t,n){if(e=this.$(n).find(i).text(),s.test(e))return a=n,!1}),a},getElementsByValue:function(t){var e,i=this.listOptions,s={};return this.each(i,function(i,a){if(e=this.$(a),e.attr("data-value")===t)return s.option=this.getOptionByValue(t),s.item=e,!1}),s},getOptionByValue:function(t){var e;return this.each(this.options,function(i,s){if(s.value===t)return e=s,!1}),e},getLabelByElement:function(t){var e=this.$(t),i=e.length>0&&e[0].tagName.toLowerCase()||"";return"option"===i?e[0].text:e.find(this.selector("label")).text()},updateLabel:function(t){return this.input.val(this.label(t)),this},label:function(t){var e=typeof t;if("undefined"!==e)return"string"===e?t:this.getLabelByElement(t);if(this.multiple)return this.config.label;var i="";return this.each(this.options,function(t,e){if(e.selected)return i=e.text,!1}),i},data:function(){var t=new RegExp(" "+this.name+" ","i"),e=" "+this.element.className+" ";return{label:this.label(),classname:e.replace(t,""),multiple:this.multiple,disabled:this.disabled,list:{id:this.uid(),items:this.getOptionData()}}},getOptionData:function(t,e,i){return t=t||this.element.children||[],e=e||[],i=i||0,this.each(t,function(t,s){var a=s.tagName.toLowerCase(),n="option"===a&&"option"||this.multiple&&"option"||"presentation";e.push({role:n,tagname:a,level:i,classname:s.className,id:s.id||this.uid(),label:s.text||s.label,selected:s.selected||!1,disabled:s.disabled||!1,alt:s.getAttribute("data-alt"),value:s.value||this.getOptgroupValue(s)}),s.children&&s.children.length>0&&this.getOptionData(s.children,e,i+1)}),e},scrollTo:function(t,e){var i=this.$(t);if(i.length>0){var s=this.list[0],a=s.scrollTop,n=a,l=s.offsetHeight;offset=i[0].offsetTop,height=i[0].offsetHeight,offset+height>a+l?n=e===!1?offset-l+height:offset:e&&offset<a&&(n=offset),n!==a&&(s.scrollTop=n)}},show:function(){var t=this.trigger,e=this.list;return this.disabled!==!0&&this.isHidden&&(this.transition(e,function(){e.addClass("in")}),this.delay(function(){this.activate(),t.attr("aria-expanded","true"),e.attr("aria-hidden","false"),this.emit("show")})),this},hide:function(){var t=this.trigger,e=this.list;return this.isOpen&&(this.transition(e,function(){e.removeClass("in")}),this.delay(function(){t.attr("aria-expanded","false"),e.attr("aria-hidden","true"),this.emit("hide")})),this},toggle:function(){return this.isHidden?this.show():this.hide()},activate:function(t,e){var i=!1;"undefined"==typeof t&&(i=!0,this.each(this.listOptions,function(e,i){if("true"===i.getAttribute("aria-selected"))return t=i,!1}));var s=this.$(t);return s.length&&"true"!==s.attr("aria-disabled")&&(this.input.attr("aria-activedescendant",s.attr("id")),this.listOptions.removeClass("active"),s.addClass("active"),i&&this.scrollTo(t),e&&this.updateLabel(t),this.emit("activate",s,e)),this},deselect:function(t,e){if(this.multiple){var i=this.getElementsByValue(t);if(i.option.selected)return i.option.selected=!1,i.item.attr("aria-selected","false"),this.input.val(this.label()),this._updateRemovableAlt(),e!==!0&&this.emit("change",this.value),!0}return this.hide(),!1},deselectAll:function(t){return this.each(this.options,function(t,e){e.selected=!1}),this.config.removable&&(this._updateRemovableAlt(),this.update()),t!==!0&&this.emit("change",this.value),this},select:function(t,e){if(t===this.config.removableId)return this.deselectAll(),!1;var i=this.getElementsByValue(t),s=this.multiple;return"undefined"==typeof i.option?this.selectGroup(t,e):!i.option.disabled&&(i.option.selected?(this.deselect(t,e),!1):(i.option.selected=!0,s!==!0&&this.listOptions.attr("aria-selected","false"),i.item.attr("aria-selected","true"),this.input.attr("aria-activedescendant",i.item.attr("id")).val(this.label()),this._updateRemovableAlt(),e!==!0&&this.emit("change",this.value),s!==!0&&this.hide(),!0))},selectGroup:function(t,e){var i=(t||"").split("|||"),s=0;return this.each(i,function(t,e){var i=this.getElementsByValue(e);i.option.selected!==!0?this.select(e,!0):s++}),s===i.length&&this.each(i,function(t,e){this.deselect(e)}),e!==!0&&this.emit("change",this.value),this},disable:function(){return this.element.disabled=!0,this.input.attr("aria-disabled","true"),this.trigger.addClass("disabled"),this.emit("disabled"),this.hide(),this},enable:function(){return this.element.disabled=!1,this.input.attr("aria-disabled","false"),this.trigger.removeClass("disabled"),this.emit("enabled"),this},update:function(){var t=this.data(),e=t.disabled&&"disable"||"enable",i=this.input,s=this.html("list",t.list);return this.items.remove(),this.list.append(s.find(this.selector("item"))),this._bindListItemEvents(),this[e](),this._param("removable","boolean",this.config,!1,this.selectmenu),this.config.removable&&this.items.find(this.selector("removable")).length>0&&this._buildRemovable(),i.attr("aria-multiselectable",t.multiple&&"true"||"false"),i.val(this.label()),this.emit("update"),this}}),e.get("Selectmenu")});