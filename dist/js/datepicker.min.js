!function(t,e){if("function"==typeof define&&define.amd)define(["mk"],function(a){return e(t,a)});else{if("object"!=typeof module||!module.exports)return e(t,t.Mk);module.exports=e(t,require("mk"))}}("undefined"!=typeof window&&window||this,function(t,e){function a(){var t=new Date;return t.setHours(0,0,0,0),t}function s(t){return t.getDate()}function i(t){return t.getMonth()}function n(t){return t.getFullYear()}function r(t,e){t.setDate("number"==typeof e?e:e.getDate())}function o(t,e){t.setMonth("number"==typeof e?e:e.getMonth())}function h(t,e){t.setFullYear("number"==typeof e?e:e.getFullYear())}function l(t,e){r(t,1),h(t,e),o(t,e),r(t,e)}function c(t){return 32-new Date(t.getFullYear(),t.getMonth(),32).getDate()}function d(t){var e=new Date;return e.setDate(1),e.setMonth(t.getMonth()-1),e.setFullYear(t.getFullYear()),c(e)}function u(t){return new Date(t.getFullYear(),t.getMonth(),1).getDay()}return e.create("Datepicker",{_date:null,_selection:null,_start:null,_end:null,name:"mk-dp",min:null,max:null,xSplit:/\/|-|,\s|\s/,xSearch:/(^|\w+)(\/|-|,\s|\s|$)/g,MIN:-864e13,MAX:864e13,formatmap:{months:["january","february","march","april","may","june","july","august","september","october","november","december"],days:["sunday","monday","tuesday","wednesday","thursday","friday","saturday"]},formats:{native:"yyyy-mm-dd",date:"mm/dd/yyyy",days:"d",month:"mmmm",year:"yyyy",nextMo:"Go to next month",nextYr:"Go to next year",prevMo:"Go to previous month",prevYr:"Go to previous year",caption:"{{month}} {{year}}",label_calendar:"{{month}} {{day}} {{year}}",label_day:"Enter a {{digit}} character day",label_month:"Enter a {{digit}} character month",label_year:"Enter a {{digit}} character year",label_start:"Choose a start date",label_end:"Choose an end date",label:"Choose a date"},templates:{shadow:'<div class="{{$key}}-shadow">\t\t\t\t\t{{template:input}}\t\t\t\t\t{{template:access}}\t\t\t\t\t{{template:calendar}}\t\t\t\t</div>',input:'<div class="{{$key}}-input" aria-label="{{label}}">\t\t\t\t\t<span id="{{labelid}}" class="{{$key}}-label">{{label}}</span>\t\t\t\t\t{{loop:inputs}}\t\t\t\t\t\t<span id="{{describeid}}" class="{{$key}}-label">{{description}}</span>\t\t\t\t\t\t<input class="{{$key}}-entry {{id}}" \t\t\t\t\t\t\tplaceholder="{{placeholder}}" \t\t\t\t\t\t\ttype="{{type}}" \t\t\t\t\t\t\tname="{{name}}" \t\t\t\t\t\t\tvalue="{{value}}" \t\t\t\t\t\t\taria-describedby="{{describeid}}" \t\t\t\t\t\t\taria-labelledby="{{labelid}}" \t\t\t\t\t\t\tdata-format="{{format}}" \t\t\t\t\t\t\tdata-key="{{id}}" />\t\t\t\t\t\t<span class="spacer">{{spacer}}</span>\t\t\t\t\t{{/loop:inputs}}\t\t\t\t</div>',calendar:'<div class="{{$key}}-calendar">\t\t\t\t\t{{template:controls}}\t\t\t\t\t{{template:table}}\t\t\t\t</div>',controls:'<div class="{{$key}}-controls">\t\t\t\t\t<button class="{{$key}}-control prev-yr" aria-label="Go to previous year"></button>\t\t\t\t\t<button class="{{$key}}-control prev-mo" aria-label="Go to previous month"></button>\t\t\t\t\t<button class="{{$key}}-control next-mo" aria-label="Go to next month"></button>\t\t\t\t\t<button class="{{$key}}-control next-yr" aria-label="Go to next year"></button>\t\t\t\t</div>',table:'<table class="{{$key}}-table">\t\t\t\t\t<caption class="{{$key}}-heading" aria-atomic="true" aria-live="assertive">{{title}}</caption>\t\t\t\t\t<thead class="{{$key}}-head">\t\t\t\t\t\t<tr>\t\t\t\t\t\t{{loop:days}}\t\t\t\t\t\t\t<th aria-label="{{day}}">{{label}}</th>\t\t\t\t\t\t{{/loop:days}}\t\t\t\t\t\t</tr>\t\t\t\t\t</thead>\t\t\t\t\t{{template:body}}\t\t\t\t</table>',body:'<tbody class="{{$key}}-body" tabindex="0">\t\t\t\t\t{{loop:weeks}}\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t{{loop:days}}\t\t\t\t\t\t\t\t{{template:day}}\t\t\t\t\t\t\t{{/loop:days}}\t\t\t\t\t\t</tr>\t\t\t\t\t{{/loop:weeks}}\t\t\t\t</tbody>',day:'<td data-value="{{value}}" class="\t\t\t\t\t{{day}} {{$key}}-day\t\t\t\t\t{{if:selectable}} selectable{{/if:selectable}}\t\t\t\t\t{{if:unselectable}} unselectable{{/if:unselectable}}\t\t\t\t\t{{if:today}} today{{/if:today}}\t\t\t\t\t{{if:active}} active{{/if:active}}\t\t\t\t\t{{if:weekend}} weekend{{/if:weekend}}\t\t\t\t\t{{if:disabled}} disabled{{/if:disabled}}\t\t\t\t\t{{if:between}} between{{/if:between}}\t\t\t\t\t{{if:rollover}} rollover{{/if:rollover}}\t\t\t\t\t" aria-label="{{label}}">\t\t\t\t\t<span>{{value}}</span>\t\t\t\t</td>',access:'<button class="{{$key}}-access" aria-label="Open Calendar Interface"></button>'},get date(){return this._date},set date(t){this._date=this.adjust(t)},get selection(){return this._selection},set selection(t){this._selection=this.adjust(t)},get start(){return this.multiple?this._start:this.selection},set start(t){this.multiple?this._start=this.adjust(t):this.selection=t},get end(){return this.multiple?this._end:this.selection},set end(t){this.multiple?this._end=this.adjust(t):this.selection=t},get disabled(){return this.rootinput.prop("disabled")},get enabled(){return!this.disabled},get isHidden(){return"true"===this.calendar.attr("aria-hidden")},get isOpen(){return!this.isHidden},get value(){return this.dts(this.selection)},get range(){return[]},get rootinput(){return this.node("")},get input(){return this.node("input",this.shadow)},get entries(){return this.node("entry",this.input)},get multiple(){return this.input.length>1},get month(){return this.node("entry.month",this.shadow)},get day(){return this.node("entry.day",this.shadow)},get year(){return this.node("entry.year",this.shadow)},get accessbtn(){return this.node("access",this.shadow)},get calendar(){return this.node("calendar",this.shadow)},get days(){return this.node("day.selectable",this.shadow)},get controls(){return this.node("control",this.shadow)},get heading(){return this.node("heading",this.shadow)},get activeDay(){var t=this.node("body",this.calendar),e=t.find(".active");return e.length||(e=t.find('[data-value="'+this.date.getDate()+'"]')),e.length||(e=t.find(".today")),e},configure:function(t){t=t||{};var e=this.rootinput;t.fdate=e.val(),t.fmin=e.attr("min"),t.fmax=e.attr("max"),this.min=t.fmin&&this.std(t.fmin)||null,this.max=t.fmax&&this.std(t.fmax)||null,this.date=this.adjust(t.fdate&&this.std(t.fdate)||a()),this.selection=this.adjust(t.fdate&&this.std(t.fdate)||a()),this.param("format","string",t,this.formats.date,e).param("rollover","boolean",t,!0,e).param("label","string",t,this.formats.label,e),this.super(t)},build:function(){this.shadow=this.html("shadow",this.data()),this.calendar.attr("aria-hidden","true"),this.adjust(this.date,!0)},mount:function(){this.shadow.appendTo(this.root)},unmount:function(){this.shadow.remove(),this.selection=this.daterange=this.config=this.shadow=this.range=this.date=this.root=null},bind:function(){var t=this,e=!1;this.selector("entry");this.input.on("focus.mk","input",function(e){var a=this;t.delay(function(){a.setSelectionRange(0,this.value.length)})}).on("blur.mk","input",function(e){t._validate(e,this)}).on("click.mk","input",function(){var e=this;t.delay(function(){e.setSelectionRange(0,this.value.length)})}).on("keydown.mk","input",function(e){t._keydownInput(e)}),this.calendar.on("focus.mk",!0,function(a){e=t.$(a.target).is(t.selector("body"))}).on("keydown.mk",!0,function(a){t._keydownCalendar(a,e)}).on("click.mk",!0,function(e){e.preventDefault(),t._click(e)}).on("mouseenter",this.selector("day"),function(e){var a=t.$(this);a.hasClass("selectable")&&t.activate(a)}),this.accessbtn.on("click.mk",function(e){e.preventDefault(),t.toggle()})},_click:function(t){var e=this.$(t.target),a=this.selector("day");return e.is(this.controls)?this._handleControl(t):(e=e.is(a)&&e||e.parent(a),void(e.length&&e.hasClass("selectable")&&this.select(e)))},_handleControl:function(t){var e=this.$(t.target);return e.hasClass("prev-mo")&&this.moveMonth(!0,!1)||e.hasClass("next-mo")&&this.moveMonth(!1,!1)||e.hasClass("prev-yr")&&this.moveYear(!0,!1)||e.hasClass("next-yr")&&this.moveYear(!1,!1)},_move:function(t,e,a){var s=a.call(this,t[0],e&&"previousSibling"||"nextSibling");if(s){if(s=this.$(s),s.hasClass("unselectable")||s.hasClass("disabled"))return this._move(s,e,a);this.activate(s)}return this},_moveY:function(t,e){return this._move(t,e,function(a,n){var h,l=t.index(),u=a.parentNode&&a.parentNode[n],f=u&&u.childNodes[l],m=this.date;return f?f:t.hasClass("disabled")?null:(h=s(m),r(m,1),o(m,i(m)+(e?-1:1)),y=e?h-7+c(m):7-(d(m)-h),r(m,y),void this.refresh(!0))})},_moveX:function(t,e){return this._move(t,e,function(a,s){if(a[s])return a[s];var n=a.parentNode&&a.parentNode[s],h=n&&n.childNodes[e&&n.childNodes.length-1||0],l=this.date;return h?h:t.hasClass("disabled")?null:(o(l,i(l)+(e?-1:1)),r(l,e?c(l):1),void this.refresh(!0))})},_entry:function(t,e,a){var s=e.data("format"),i=e.val(),n=null;switch(s){case"d":case"m":case"dd":case"mm":case"yy":n=2;break;case"mmm":n=3;break;case"yyyy":n=4}n&&(i+a).length>n&&(t.preventDefault(),e.val(i.slice((n-1)*-1)+a))},_validate:function(t,e){var a,s=this.$(e),n=s.data("format"),r=s.val();switch(n){case"d":case"dd":r=parseInt(r,10),r>c(this.selection)&&(r=c(this.selection));break;case"m":case"mm":r=parseInt(r,10),r>12?r=12:r<1&&(r=1),r-=1;break;case"mmm":r=r.toLowerCase(),r=this.first(this.formatmap.months,function(t){if(t.indexOf(r)>-1)return r}),r||(r=this.format(n,i(this.selection)))}r=parseInt(r,10),a=this.getValue(n,this.selection),s.val(this.format(n,r)),r!==a&&(this.setValue(n,r,this.selection),this.valid(this.selection)&&this.emit("change",this.value))},_keydownInput:function(t){var e=t.target,a=this.$(e),s=t.which,i=this.keycode,n=String.fromCharCode(s).toLowerCase();if(s!==i.tab&&s!==i.backspace){if(/\w/.test(n)&&a.hasClass("month")&&a.data("format").length>2||/\d/.test(n))return void this._entry(t,a,n);switch(t.preventDefault(),s){case i.up:case i.down:this.step(a,s===i.down),e.setSelectionRange(0,e.value.length);break;case i.left:case i.right:this._focusNext(e,s===i.left)}}},_keydownCalendar:function(t,e){var a,s=t.which,i=this.keycode;if(s!==i.tab)switch(t.preventDefault(),a=this.activeDay,s){case i.up:case i.down:return e&&this._moveY(a,s===i.up);case i.left:case i.right:return e&&this._moveX(a,s===i.left);case i.esc:return console.info("hide calendar");case i.pageup:case i.pagedown:return this.moveMonth(s===i.pageup,!0);case i.enter:case i.space:return e&&this.select()||this._handleControl(t);case i.home:case i.end:e&&this.activate(s===i.home?1:c(this.date))}},_focusNext:function(t,e){var a,s=!1,i=[].slice.call(t.parentNode.childNodes);e&&i.reverse(),a=this.first(i,function(e){return s&&e.classList.contains(this.name+"-entry")?e:void(e===t&&(s=!0))}),a&&a.focus()},step:function(t,e){var a,s=t.data("format"),i=this.getValue(s);i+=e?-1:1,a=this.setValue(s,i),t.val(a)},data:function(){var t,e=this.config,a=e.formats,s=a.days.length,r=this.selection,o=this.date,h=this,l=[],c=this.uid();return e.format.replace(this.xSearch,function(e,s,i){t=/m/.test(s)&&"month"||/y/.test(s)&&"year"||"day",l.push({name:h.uid(),format:s,value:h.valid(r)?h.format(s,h.getValue(s,r)):"",placeholder:s,spacer:i.replace(/\s/g,"&nbsp;"),type:"text",id:t,labelid:c,describeid:h.uid(),description:h.format(a["label_"+t],{digit:s.length})})}),{inputs:l,label:e.label,labelid:c,date:e.fdate?this.dts(o,e.format):e.format,weeks:this.buildCalendar(o),title:this.format("caption",{month:this.format(a.month,i(o)),year:this.format(a.year,n(o))}),days:this.map(this.formatmap.days,function(t){return{day:t,label:s<4&&t.slice(0,s)||t}})}},buildCalendar:function(t){var e,i,n,l,d=a(),f=c(t),m=u(t),b=s(t),p=[];for(t.setHours(0,0,0,0),n={days:[]},h(d,t),o(d,t.getMonth()-1),e=c(d),i=e-(m-1),l=0;i<=e;i++)r(d,i),n.days.push(this.buildDay(d,l++));for(r(d,1),h(d,t),o(d,t),l=1;l<=f;l++)r(d,l),n.days.push(this.buildDay(d,m++,!0,l===b)),m>6&&(p.push(n),m=0,n={days:[]});if(0!==m)for(r(d,1),o(d,d.getMonth()+1),l=1;m<=6;m++)r(d,l++),n.days.push(this.buildDay(d,m));return p.push(n),p},buildDay:function(t,e,r,o){var h=a(),l=this.config.formats,c=this.max&&t>this.max||this.min&&t<this.min||!1;return h.setHours(0,0,0,0),{value:s(t),label:this.format("label_calendar",{day:s(t),month:this.format(l.month,i(t)),year:this.format(l.year,n(t))}),active:o,disabled:c,selectable:!c&&r,unselectable:!!c||!r,rollover:this.config.rollover,weekend:!e||e>5,day:this.formatmap.days[e],today:h===t}},activate:function(t){var e,a=this.activeDay;return e="number"==typeof t?this.days.filter('[data-value="'+t+'"]'):this.$(t),e.length&&!e.hasClass("active")&&(r(this.date,parseInt(e.data("value"),10)),a.removeClass("active"),e.addClass("active"),this.emit("activate",e)),this},select:function(t,e){var a,t;if(a=t?"number"==typeof t?this.days.filter('[data-value="'+t+'"]'):this.$(t):this.activeDay,!a.hasClass("disabled"))return this.activate(t),t=parseInt(a.data("value"),10),t!==s(this.selection)&&this.setDate(this.date)&&!e&&this.emit("change"),this},valid:function(t){var e=t.getTime();return!isNaN(e)&&e>this.MIN&&e<this.MAX},setDate:function(t){var e,a,s,i=this.selection;return t.setHours(0,0,0,0),this.min&&t<this.min?l(i,this.min):this.max&&t>this.max?l(i,this.max):this.each([this.year,this.month,this.day],function(s,n){e=!n&&"FullYear"||n<2&&"Month"||n<3&&"Date",a=t["get"+e](),i["set"+e](a),s.val(this.format(s.data("format")),a)}),s=this.valid(i),s&&(l(this.date,i),this.rootinput.val(this.dts(i)),this.refresh()),s},adjust:function(t,e){var a=this.min,c=this.max,d=this.controls,u=[];return a&&(n(t)<n(a)?(l(t,a),u.push(".prev-yr",".prev-mo")):n(t)===n(a)&&(h(t,a),u.push(".prev-yr"),i(t)<=i(a)&&(o(t,a),u.push(".prev-mo"),s(t)<=s(a)&&r(t,a)))),c&&(n(t)>n(c)?(l(t,c),u.push(".prev-yr",".prev-mo")):n(t)>=n(c)&&(h(t,c),u.push(".next-yr"),i(t)>=i(c)&&(o(t,c),u.push(".next-mo"),s(t)>=s(c)&&r(t,c)))),e&&(d.prop("disabled",!1),this.each(u,function(t){d.filter(t).prop("disabled",!0)})),t},refresh:function(t){var e=this.adjust(this.date,!0),a=this.calendar,s=this.config.formats,r=this.html("body",{weeks:this.buildCalendar(e)});return this.node("body",a).remove(),this.node("table",a).append(r),t&&this.node("body",a).focus(),this.heading.text(this.format("caption",{month:this.format(s.month,i(e)),year:this.format(s.year,n(e))})),this},moveMonth:function(t,e){var a=this.date;return o(a,i(a)+(t?-1:1)),this.refresh(e)},moveYear:function(t,e){var a=this.date;return h(a,n(a)+(t?-1:1)),this.refresh(e)},setValue:function(t,e,a){var s,i=a||this.date;switch(t.slice(0,1)){case"d":s=c(i),e=e>s&&1||e>0&&e||s,r(i,e);break;case"m":e=e<0&&11||e<12&&e||0,o(i,e);break;case"y":h(i,e)}return this.format(t,e)},getValue:function(t,e){var a=e||this.date;switch(t.slice(0,1)){case"y":return n(a);case"m":return i(a);case"d":return t.length>2?a.getDay():s(a)}return NaN},format:function(t,e){if("object"==typeof e)return this.super(t,e);if("undefined"==typeof e&&(e=this.getValue(t)),isNaN(e))return t;var a,s=this,i=s.formatmap;switch(t){case"m":return e+1;case"mm":return++e<10&&"0"+e||e;case"mmm":return a=i.months[e].slice(0,3),a.charAt(0).toUpperCase()+a.slice(1);case"mmmm":return a=i.months[e],a.charAt(0).toUpperCase()+a.slice(1);case"d":return e;case"dd":return e<10&&"0"+e||e;case"yyyy":return e;case"yy":return e.toString().slice(2)}},unformat:function(t,e){var a=this,s=a.formatmap;switch(t){case"m":case"d":case"mm":case"dd":case"yy":case"yyyy":return parseInt(e,10);case"mmm":return e=e.toLowerCase(),this.first(s.months,function(t,a){if(t.indexOf(e)>-1)return a});case"mmmm":return s.months.indexOf(e.toLowerCase())}return NaN},std:function(t,e){var s,i=a(),n=t.split(this.xSplit),e=(e||this.formats.native).split(this.xSplit);return this.each(e,function(t,e){s=parseInt(n[e],10),t.indexOf("m")>-1&&(s-=1),this.setValue(t,s,i)}),i},dts:function(t,e){t=t||this.date,e=e||this.config.formats.native;var a;return this.each(e.split(this.xSplit),function(s){a=this.format(s,this.getValue(s,t)),e=e.replace(new RegExp(s),a)}),e},disable:function(){return this.enabled&&(this.each([this.rootinput,this.day,this.month,this.year],function(t){t.prop("disabled",!0),t.addClass("disabled")}),this.calendar.addClass("disabled")),this},enable:function(){return this.disabled&&(this.each([this.rootinput,this.day,this.month,this.year],function(t){t.prop("disabled",!1),t.removeClass("disabled")}),this.calendar.removeClass("disabled")),this},show:function(){return this.enabled&&this.isHidden&&this.calendar.attr("aria-hidden","false"),this},hide:function(){return this.isOpen&&this.calendar.attr("aria-hidden","true"),this},toggle:function(){return this.enabled&&this.isHidden?this.show():this.hide()}}),e.get("Datepicker")});