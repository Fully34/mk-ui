!function(t,e){if("function"==typeof define&&define.amd)define(["mk"],function(a){return e(t,a)});else{if("object"!=typeof module||!module.exports)return e(t,t.Mk);module.exports=e(t,require("mk"))}}("undefined"!=typeof window&&window||this,function(t,e){function a(t){return 32-new Date(t.getFullYear(),t.getMonth(),32).getDate()}function i(t){var e=new Date;return e.setDate(1),e.setMonth(t.getMonth()-1),e.setFullYear(t.getFullYear()),a(e)}function n(t){return new Date(t.getFullYear(),t.getMonth(),1).getDay()}return e.create("Datepicker",{name:"mk-dp",index:-1,xSplit:/\/|-|,\s|\s/,xSearch:/(^|\w+)(\/|-|,\s|\s)/g,uidate:null,date:null,daterange:null,min:null,max:null,formatmap:{months:["january","february","march","april","may","june","july","august","september","october","november","december"],days:["sunday","monday","tuesday","wednesday","thursday","friday","saturday"]},formats:{native:"yyyy-mm-dd",date:"mm/dd/yyyy",days:"d",month:"mmmm",year:"yyyy",nextMo:"Go to next month",nextYr:"Go to next year",prevMo:"Go to previous month",prevYr:"Go to previous year",caption:"{{month}} {{year}}",label:"{{month}} {{day}} {{year}}"},templates:{shadow:'<div class="{{$key}}-shadow">\t\t\t\t\t{{template:input}}\t\t\t\t\t{{template:access}}\t\t\t\t\t{{template:calendar}}\t\t\t\t</div>',calendar:'<div class="{{$key}}-calendar">\t\t\t\t\t{{template:controls}}\t\t\t\t\t{{template:table}}\t\t\t\t</div>',controls:'<div class="{{$key}}-controls">\t\t\t\t\t<button class="{{$key}}-control prev-yr" aria-label="Go to previous year"></button>\t\t\t\t\t<button class="{{$key}}-control prev-mo" aria-label="Go to previous month"></button>\t\t\t\t\t<button class="{{$key}}-control next-mo" aria-label="Go to next month"></button>\t\t\t\t\t<button class="{{$key}}-control next-yr" aria-label="Go to next year"></button>\t\t\t\t</div>',table:'<table class="{{$key}}-table">\t\t\t\t\t<caption class="{{$key}}-heading" aria-atomic="true" aria-live="assertive">{{title}}</caption>\t\t\t\t\t<thead class="{{$key}}-head">\t\t\t\t\t\t<tr>\t\t\t\t\t\t{{loop:days}}\t\t\t\t\t\t\t<th aria-label="{{day}}">{{label}}</th>\t\t\t\t\t\t{{/loop:days}}\t\t\t\t\t\t</tr>\t\t\t\t\t</thead>\t\t\t\t\t{{template:body}}\t\t\t\t</table>',body:'<tbody class="{{$key}}-body" tabindex="0">\t\t\t\t\t{{loop:weeks}}\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t{{loop:days}}\t\t\t\t\t\t\t\t{{template:day}}\t\t\t\t\t\t\t{{/loop:days}}\t\t\t\t\t\t</tr>\t\t\t\t\t{{/loop:weeks}}\t\t\t\t</tbody>',day:'<td data-value="{{value}}" class="\t\t\t\t\t{{day}} {{$key}}-day\t\t\t\t\t{{if:selectable}} selectable{{/if:selectable}}\t\t\t\t\t{{if:today}} today{{/if:today}}\t\t\t\t\t{{if:active}} active{{/if:active}}\t\t\t\t\t{{if:weekend}} weekend{{/if:weekend}}\t\t\t\t\t{{if:inactive}} inactive{{/if:inactive}}\t\t\t\t\t{{if:disabled}} disabled{{/if:disabled}}\t\t\t\t\t{{if:between}} between{{/if:between}}\t\t\t\t\t{{if:rollover}} rollover{{/if:rollover}}\t\t\t\t\t" aria-label="{{label}}">\t\t\t\t\t<span>{{value}}</span>\t\t\t\t</td>',input:'<input class="{{$key}}-input" type="text" value="{{date}}" />',access:'<button class="{{$key}}-access">Open</button>'},get value(){return this.dts()},get range(){return[]},get rootinput(){return this.node("")},get input(){return this.node("input",this.shadow)},get accessbtn(){return this.node("access",this.shadow)},get calendar(){return this.node("calendar",this.shadow)},get days(){return this.node("day .selectable",this.shadow)},get controls(){return this.node("control",this.shadow)},get heading(){return this.node("heading",this.shadow)},get activeDay(){var t=this.node("body",this.calendar),e=t.find(".active");return e.length||(e=t.find('[data-value="'+this.uidate.getDate()+'"]')),e.length||(e=t.find(".today")),e},configure:function(t){t=t||{};var e=this.rootinput;t.fdate=e.val(),t.fmin=e.attr("min"),t.fmax=e.attr("max"),this.uidate=t.fdate&&this.std(t.fdate)||new Date,this.date=t.fdate&&this.std(t.fdate)||new Date,this.min=t.fmin&&this.std(t.fmin)||null,this.max=t.fmax&&this.std(t.fmax)||null,this.param("format","string",t,this.formats.date,e).param("rollover","boolean",t,!0,e),this.super(t)},build:function(){this.shadow=this.html("shadow",this.data())},mount:function(){this.node("body",this.calendar).addClass("in"),this.shadow.appendTo(this.root)},unmount:function(){this.shadow.remove(),this.config=this.shadow=this.uidate=this.root=null},bind:function(){var t=this,e=!1;this.input.on("focus.mk",!0,function(e){t._focus(e.relatedTarget)}).on("keydown.mk",function(e){t._keydown(e)}),this.calendar.on("focus.mk",!0,function(a){e=t.$(a.target).is("tbody")}).on("keydown.mk",!0,function(a){t._keydownCalendar(a,e)}).on("click.mk",!0,function(e){e.preventDefault(),t._click(e)}),this.accessbtn.on("click.mk",function(t){t.preventDefault()})},_click:function(t){var e=this.$(t.target),a=this.selector("day");return e.is(this.controls)?this._handleControl(t):(e=e.is(a)&&e||e.parent(a),void(e.length&&this.select(e)))},_handleControl:function(t){var e=this.$(t.target);return e.hasClass("prev-mo")&&this.moveMonth(!0,!1)||e.hasClass("next-mo")&&this.moveMonth(!1,!1)||e.hasClass("prev-yr")&&this.moveYear(!0,!1)||e.hasClass("next-yr")&&this.moveYear(!1,!1)},_focus:function(t){var e=this.$(t),a=this.config.format.split(this.xSplit),i=0;e.parent(this.shadow).length&&(i=a.length-1),this.index=i,this.delay(function(){this.setSelection(i)})},_move:function(t,e,a){var i=a.call(this,t[0],e&&"previousSibling"||"nextSibling");if(i){if(i=this.$(i),i.hasClass("inactive"))return this._move(i,e,a);this.activate(i)}return this},_moveY:function(t,e){return this._move(t,e,function(n,s){var o,r=t.index(),h=n.parentNode&&n.parentNode[s],l=h&&h.childNodes[r],u=this.uidate;return l?l:(o=u.getDate(),u.setDate(1),u.setMonth(u.getMonth()+(e?-1:1)),y=e?o-7+a(u):7-(i(u)-o),u.setDate(y),void this.refresh(!0))})},_moveX:function(t,e){return this._move(t,e,function(t,i){if(t[i])return t[i];var n=t.parentNode&&t.parentNode[i],s=n&&n.childNodes[e&&n.childNodes.length-1||0],o=this.uidate;return s?s:(o.setMonth(o.getMonth()+(e?-1:1)),o.setDate(e?a(o):1),void this.refresh(!0))})},_keydownCalendar:function(t,e){var i,n=t.which,s=this.keycode;if(n!==s.tab)switch(t.preventDefault(),i=this.activeDay,n){case s.up:case s.down:return e&&this._moveY(i,n===s.up);case s.left:case s.right:return e&&this._moveX(i,n===s.left);case s.esc:return console.info("hide calendar");case s.pageup:case s.pagedown:return this.moveMonth(n===s.pageup,!0);case s.enter:case s.space:return e&&this.select()||this._handleControl(t);case s.home:case s.end:e&&this.activate(n===s.home?1:a(this.uidate))}},_keydown:function(t){var e,a=t.which,i=this.keycode;switch(a){case i.tab:case i.left:case i.right:this._setSelection(t,this.index,t.shiftKey||a===i.left,a!==i.tab);break;case i.up:case i.down:t.preventDefault(),this.changeSelection(a===i.up&&1||-1);break;case i.space:t.preventDefault();break;default:e=String.fromCharCode(a),/\w/.test(e)||t.preventDefault()}},_setSelection:function(t,e,a,i){e+=a?-1:1;var n=this.config.format,s=n.split(this.xSplit),o=!1;e<0?(e=0,o=!i):e>s.length-1&&(e=s.length-1,o=!i),o||(t.preventDefault(),this.index=e,this.setSelection(e))},data:function(){var t=this.config,e=t.formats,a=e.days.length,i=this.uidate;return{date:t.fdate?this.dts(i,t.format):t.format,weeks:this.buildCalendar(i),title:this.format("caption",{month:this.format(e.month,i.getMonth()),year:this.format(e.year,i.getFullYear())}),days:this.map(this.formatmap.days,function(t){return{day:t,label:a<4&&t.slice(0,a)||t}})}},buildCalendar:function(t){var e,i,s,o,r,h,l=new Date,u=a(t),c=n(t),d=(this.config.rollover,[]);for(s={days:[]},l.setDate(1),l.setFullYear(t.getFullYear()),l.setMonth(t.getMonth()-1),o=l.getMonth(),r=l.getFullYear(),e=a(l),i=e-(c-1),h=0;i<=e;i++)s.days.push(this.buildDay(r,o,i,h++,!0));for(l.setFullYear(t.getFullYear()),l.setMonth(t.getMonth()),l.setDate(t.getDate()),o=t.getMonth(),r=t.getFullYear(),h=1;h<=u;h++)s.days.push(this.buildDay(r,o,h,c++,!1,h===l.getDate())),c>6&&(d.push(s),c=0,s={days:[]});if(0!==c)for(l.setMonth(o+1),o=l.getMonth(),r=l.getFullYear(),h=1;c<=6;c++)s.days.push(this.buildDay(r,o,h++,c,!0));return d.push(s),d},buildDay:function(t,e,a,i,n,s){var o=new Date;return{value:a,label:this.format("label",{day:a,month:this.format("mmmm",e),year:this.format("yyyy",t)}),active:s,inactive:n,selectable:!n,rollover:this.config.rollover,weekend:!i||i>5,day:this.formatmap.days[i],today:a===o.getDate()&&e===o.getMonth()&&t===o.getFullYear()}},activate:function(t){var e,a=this.activeDay;return e="number"==typeof t?this.first(this.days.filter('[data-value="'+t+'"]'),function(t){if(!t.classList.contains("inactive"))return this.$(t)}):this.$(t),e.length&&!e.hasClass("active")&&(this.uidate.setDate(parseInt(e.data("value"),10)),a.removeClass("active"),e.addClass("active"),this.emit("activate",e)),this},select:function(t,e){var a,t;if(a=t?"number"==typeof t?this.days.filter('[data-value="'+t+'"]'):this.$(t):this.activeDay,!a.hasClass("disabled"))return this.activate(t),t=parseInt(a.data("value"),10),t!==this.date.getDate()&&(this.date.setDate(t),this.input.val(this.dts(this.date,this.config.format)),this.rootinput.val(this.dts(this.date)),e||this.emit("change")),this},refresh:function(t){var e=this.calendar,a=this.html("body",{weeks:this.buildCalendar(this.uidate)});return this.node("body",e).remove(),this.node("table",e).append(a),this.updateLabel(),t&&this.node("body",e).focus(),this},updateLabel:function(){var t=this.config.formats,e=this.uidate;return this.heading.text(this.format("caption",{month:this.format(t.month,e.getMonth()),year:this.format(t.year,e.getFullYear())})),this},moveMonth:function(t,e){return this.uidate.setMonth(this.uidate.getMonth()+(t?-1:1)),this.refresh(e)},moveYear:function(t,e){return this.uidate.setFullYear(this.uidate.getFullYear()+(t?-1:1)),this.refresh(e)},getSelection:function(t){var e,a=this.input,i=a.val(),n=i.split(this.xSplit),s=n[t];if(s){e=-1,i=i.replace(this.xSearch,function(a,i,n){return++e,e!==t?new Array(i.length+1).join("*")+n:i+n});var o=i.indexOf(s),r=o+s.length;return{value:i.slice(o,r),range:[o,r]}}return null},setSelection:function(t){var e=this.getSelection(t);return e&&this.input[0].setSelectionRange(e.range[0],e.range[1]),this},changeSelection:function(t){var e,a,i,n=this.getSelection(this.index),s=this.input;n&&(e=this.config.format.split(this.xSplit)[this.index],a=this.getValue(e),a=this.setValue(e,a+t),i=s.val().split(""),i.splice(n.range[0],n.value.length,a),s.val(i.join("")),this.setSelection(this.index))},setValue:function(t,e,i){var n,s=i||this.uidate;switch(t.slice(0,1)){case"d":n=a(s),e=e>n&&1||e>0&&e||n,s.setDate(e);break;case"m":e=e<0&&11||e<12&&e||0,s.setMonth(e);break;case"y":s.setFullYear(e)}return this.format(t,e)},getValue:function(t,e){var a=e||this.uidate;switch(t.slice(0,1)){case"y":return a.getFullYear();case"m":return a.getMonth();case"d":return t.length>2?a.getDay():a.getDate()}return-1},format:function(t,e){if("object"==typeof e)return this.super(t,e);var a=this.formatmap;switch(t){case"m":return e+1;case"mm":return++e<10&&"0"+e||e;case"mmm":return a.months[e].slice(0,3);case"mmmm":return a.months[e];case"d":return e;case"dd":return e<10&&"0"+e||e;case"ddd":return a.days[e].slice(0,2);case"dddd":return a.days[e];case"yyyy":return e;case"yy":return e.toString().slice(2)}},std:function(t){var e,a=new Date,i=t.split(this.xSplit),n=this.formats.native.split(this.xSplit);return this.each(n,function(t,n){e=parseInt(i[n],10),t.indexOf("m")>-1&&(e-=1),this.setValue(t,e,a)}),a},dts:function(t,e){t=t||this.uidate,e=e||this.config.formats.native;return this.each(e.split(this.xSplit),function(a){value=this.format(a,this.getValue(a,t)),e=e.replace(new RegExp(a),value)}),e}}),e.get("Datepicker")});