!function(t,e){if("function"==typeof define&&define.amd)define(["mk"],function(a){return e(t,a)});else{if("object"!=typeof module||!module.exports)return e(t,t.Mk);module.exports=e(t,require("mk"))}}("undefined"!=typeof window&&window||this,function(t,e){return e.create("Datepicker",{name:"mk-dp",index:-1,xSeperate:/\/|-|,\s|\s/,xSearch:/(^|\w+)(\/|-|,\s|\s)/g,formatmap:{months:["january","february","march","april","may","june","july","august","september","october","november","december"],days:["sunday","monday","tuesday","wednesday","thursday","friday","saturday"]},formats:{native:"yyyy-mm-dd",date:"mm/dd/yyyy",days:"d",month:"mmmm",year:"yyyy",nextMo:"Go to next month",nextYr:"Go to next year",prevMo:"Go to previous month",prevYr:"Go to previous year",caption:"{{month}} {{year}}",label:"{{month}} {{day}} {{year}}"},templates:{shadow:'<div class="{{$key}}-shadow">\t\t\t\t\t{{template:input}}\t\t\t\t\t{{template:access}}\t\t\t\t\t{{template:calendar}}\t\t\t\t</div>',calendar:'<div class="{{$key}}-calendar">\t\t\t\t\t{{template:controls}}\t\t\t\t\t{{template:table}}\t\t\t\t</div>',controls:'<div class="{{$key}}-controls">\t\t\t\t\t<button class="{{$key}}-control prev-yr" aria-label="Go to previous year"></button>\t\t\t\t\t<button class="{{$key}}-control prev-mo" aria-label="Go to previous month"></button>\t\t\t\t\t<button class="{{$key}}-control next-mo" aria-label="Go to next month"></button>\t\t\t\t\t<button class="{{$key}}-control next-yr" aria-label="Go to next year"></button>\t\t\t\t</div>',table:'<table class="{{$key}}-table">\t\t\t\t\t<caption class="{{$key}}-heading" aria-atomic="true" aria-live="assertive">{{title}}</caption>\t\t\t\t\t<thead class="{{$key}}-head">\t\t\t\t\t\t<tr>\t\t\t\t\t\t{{loop:days}}\t\t\t\t\t\t\t<th aria-label="{{day}}">{{label}}</th>\t\t\t\t\t\t{{/loop:days}}\t\t\t\t\t\t</tr>\t\t\t\t\t</thead>\t\t\t\t\t{{template:body}}\t\t\t\t</table>',body:'<tbody class="{{$key}}-body" tabindex="0">\t\t\t\t\t{{loop:weeks}}\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t{{loop:days}}\t\t\t\t\t\t\t\t{{template:day}}\t\t\t\t\t\t\t{{/loop:days}}\t\t\t\t\t\t</tr>\t\t\t\t\t{{/loop:weeks}}\t\t\t\t</tbody>',day:'<td data-value="{{value}}" class="\t\t\t\t\t{{day}}\t\t\t\t\t{{if:today}} today{{/if:today}}\t\t\t\t\t{{if:active}} active{{/if:active}}\t\t\t\t\t{{if:weekend}} weekend{{/if:weekend}}\t\t\t\t\t{{if:inactive}} inactive{{/if:inactive}}\t\t\t\t\t{{if:disabled}} disabled{{/if:disabled}}\t\t\t\t\t{{if:between}} between{{/if:between}}\t\t\t\t\t" aria-label="label">\t\t\t\t\t<span>{{value}}</span>\t\t\t\t</td>',input:'<input class="{{$key}}-input" type="text" value="{{date}}" />',access:'<button class="{{$key}}-access">Open</button>'},get rootinput(){return this.node("")},get input(){return this.node("input",this.shadow)},get accessbtn(){return this.node("access",this.shadow)},get calendar(){return this.node("calendar",this.shadow)},get active(){var t=this.node("body",this.calendar),e=t.find(".active");return e.length||(e=t.find('[data-value="'+this.date.getDate()+'"]')),e.length||(e=t.find(".today")),e.length||(e=this.$(t.find("td")[0])),e},configure:function(t){t=t||{};var e=this.rootinput;t.fdate=e.val(),t.date=t.fdate&&this.stringToDate(t.fdate)||new Date,t.fmin=e.attr("min"),t.min=t.fmin&&this.stringToDate(t.fmin)||null,t.fmax=e.attr("max"),t.max=t.fmax&&this.stringToDate(t.fmax)||null,this.date=t.date,this.param("format","string",t,this.formats.date,e).param("rollover","boolean",t,!0,e),this.super(t)},data:function(){var t=this.config,e=t.formats,a=e.days.length;return{date:t.fdate?this.dateToString(this.date,t.format):t.format,weeks:this.buildCalendar(this.date),title:this.format("caption",{month:this.formatValue(e.month,this.date.getMonth()),year:this.formatValue(e.year,this.date.getFullYear())}),days:this.map(this.formatmap.days,function(t){return{day:t,label:a<4&&t.substring(0,a)||t}})}},buildCalendar:function(t){var e,a,n,s,i=new Date,o=this.daysInMonth(t),r=this.daysInLastMonth(t),h=this.startDayInMonth(t),l=this.config.rollover,d=r-(h-1),u=[];for(i.setDate(t.getDate()),i.setMonth(t.getMonth()),i.setFullYear(t.getFullYear()),e={days:[]},i.setMonth(t.getMonth()-1),a=i.getMonth(),n=i.getFullYear(),s=0;d<=r;d++)e.days.push(l?this.buildDay(n,a,d,s,!0):{}),s++;for(i.setMonth(t.getMonth()),i.setFullYear(t.getFullYear()),a=t.getMonth(),n=t.getFullYear(),s=1;s<=o;s++)e.days.push(this.buildDay(n,a,s,h,!1,s===i.getDate())),h++,h>6&&(u.push(e),h=0,e={days:[]});if(0!==h)for(i.setMonth(a+1),a=i.getMonth(),n=i.getFullYear(),s=1;h<=6;h++)e.days.push(l?this.buildDay(n,a,s,h,!0):{}),s++;return u.push(e),u},buildDay:function(t,e,a,n,s,i){var o=new Date;return{value:a,label:this.format("label",{day:a,month:this.formatValue("mmmm",e),year:this.formatValue("yyyy",t)}),active:i,inactive:s,weekend:!n||n>5,day:this.formatmap.days[n],today:a===o.getDate()&&e===o.getMonth()&&t===o.getFullYear()}},build:function(){this.shadow=this.html("shadow",this.data())},mount:function(){this.node("body",this.calendar).addClass("in"),this.shadow.appendTo(this.root)},unmount:function(){this.shadow.remove(),this.config=this.shadow=this.date=this.root=null},bind:function(){var t=this,e=!1;this.input.on("focus.mk",!0,function(e){t._focus(e.relatedTarget)}).on("keydown.mk",function(e){t._keydown(e)}),this.calendar.on("focus.mk",!0,function(a){e=t.$(a.target).is("tbody")}).on("keydown.mk",!0,function(a){t._keydownCalendar(a,e)}).on("click.mk",!0,function(e){e.preventDefault(),t._click(e)}),this.accessbtn.on("click.mk",function(t){t.preventDefault()})},_click:function(t){var e=this.$(t.target);e.is(this.selector("control"))&&this._handleControl(t)},_handleControl:function(t){var e=this.$(t.target);return e.hasClass("prev-mo")&&this.moveMonth(!0,!1)||e.hasClass("next-mo")&&this.moveMonth(!1,!1)||e.hasClass("prev-yr")&&this.moveYear(!0,!1)||e.hasClass("next-yr")&&this.moveYear(!1,!1)},_focus:function(t){var e=this.$(t),a=this.config.format.split(this.xSeperate),n=0;e.parent(this.shadow).length&&(n=a.length-1),this.index=n,this.delay(function(){this.setSelection(n)})},_move:function(t){var e=this.keycode,a=this.active;return a.removeClass("active"),t===e.left?this._left(a[0]):t===e.right?this._right(a[0]):void 0},_moveX:function(t,e){var a,n,s=e&&"previousSibling"||"nextSibling";if(t[s])a=t[s];else if(n=t.parentNode&&t.parentNode[s],a=n&&n.childNodes[e&&n.childNodes.length-1||0],!a)return this.moveMonth(e,!0);return a=this.$(a),a.hasClass("inactive")?this._moveX(a[0],e):(this.date.setDate(parseInt(a.data("value"),10)),void a.addClass("active"))},_left:function(t){return this._moveX(t,!0)},_right:function(t){return this._moveX(t,!1)},_up:function(t){},_down:function(t){},_keydownCalendar:function(t,e){var a=t.which,n=this.keycode;switch(a){case n.up:case n.down:case n.left:case n.right:t.preventDefault(),e&&this._move(a);break;case n.esc:t.preventDefault(),console.info("hide calendar");break;case n.pageup:case n.pagedown:t.preventDefault(),this.moveMonth(a===n.pageup,!0);break;case n.enter:case n.space:t.preventDefault(),e?console.info("select date"):this._handleControl(t);break;case n.home:case n.end:t.preventDefault(),e&&console.info("move to first or last date")}},_keydown:function(t){var e,a=t.which,n=this.keycode;switch(a){case n.tab:case n.left:case n.right:this._setSelection(t,this.index,t.shiftKey||a===n.left,a!==n.tab);break;case n.up:case n.down:t.preventDefault(),this.changeSelection(a===n.up&&1||-1);break;case n.space:t.preventDefault();break;default:e=String.fromCharCode(a),/\w/.test(e)||t.preventDefault()}},_setSelection:function(t,e,a,n){e+=a?-1:1;var s=this.config.format,i=s.split(this.xSeperate),o=!1;e<0?(e=0,o=!n):e>i.length-1&&(e=i.length-1,o=!n),o||(t.preventDefault(),this.index=e,this.setSelection(e))},refresh:function(t){var e=this.calendar,a=this.html("body",{weeks:this.buildCalendar(this.date)});return this.node("body",e).remove(),this.node("table",e).append(a),this.updateLabel(),t&&this.node("body",e).focus(),this},updateLabel:function(){var t=this.config.formats,e=this.date;return this.node("heading",this.calendar).text(this.format("caption",{month:this.formatValue(t.month,e.getMonth()),year:this.formatValue(t.year,e.getFullYear())})),this},moveMonth:function(t,e){return this.date.setMonth(this.date.getMonth()+(t?-1:1)),this.refresh(e)},moveYear:function(t,e){return this.date.setFullYear(this.date.getFullYear()+(t?-1:1)),this.refresh(e)},getSelection:function(t){var e,a=this.input,n=a.val(),s=n.split(this.xSeperate),i=s[t];if(i){e=-1,n=n.replace(this.xSearch,function(a,n,s){return++e,e!==t?new Array(n.length+1).join("*")+s:n+s});var o=n.indexOf(i),r=o+i.length;return{value:n.substring(o,r),range:[o,r]}}return null},setSelection:function(t){var e=this.getSelection(t);return e&&this.input[0].setSelectionRange(e.range[0],e.range[1]),this},changeSelection:function(t){var e,a,n,s=this.getSelection(this.index),i=this.input;s&&(e=this.config.format.split(this.xSeperate)[this.index],a=this.getValue(e),a=this.setValue(e,a+t),n=i.val().split(""),n.splice(s.range[0],s.value.length,a),i.val(n.join("")),this.setSelection(this.index))},setValue:function(t,e,a){var n,s=a||this.date;switch(t){case"d":case"dd":n=this.daysInMonth(s),e=e>n&&1||e>0&&e||n,s.setDate(e);break;case"m":case"mm":case"mmm":case"mmmm":e=e<0&&11||e<12&&e||0,s.setMonth(e);break;case"yy":case"yyyy":s.setFullYear(e)}return this.formatValue(t,e)},getValue:function(t,e){var a=e||this.date;return/y/.test(t)?a.getFullYear():/m/.test(t)?a.getMonth():/d/.test(t)?t.length>2?a.getDay():a.getDate():-1},formatValue:function(t,e){var a=this.formatmap;switch(t){case"m":return e+1;case"mm":return++e<10&&"0"+e||e;case"mmm":return a.months[e].substring(0,3);case"mmmm":return a.months[e];case"d":return e;case"dd":return e<10&&"0"+e||e;case"ddd":return a.days[e].substring(0,2);case"dddd":return a.days[e];case"yyyy":return e;case"yy":return e.toString().slice(2)}},stringToDate:function(t){var e,a=new Date,n=t.split(this.xSeperate),s=this.formats.native.split(this.xSeperate);return this.each(s,function(t,s){e=parseInt(n[s],10),t.indexOf("m")>-1&&(e-=1),this.setValue(t,e,a)}),a},dateToString:function(t,e){var a=e||this.config.formats.native;return this.each(a.split(this.xSeperate),function(e){value=this.formatValue(e,this.getValue(e,t)),a=a.replace(new RegExp(e),value)}),a},daysInMonth:function(t){return 32-new Date(t.getFullYear(),t.getMonth(),32).getDate()},daysInLastMonth:function(t){var e=new Date;return e.setMonth(t.getMonth()-1),this.daysInMonth(e)},daysInNextMonth:function(t){var e=new Date;return e.setMonth(t.getMonth()+1),this.daysInMonth(e)},startDayInMonth:function(t){return new Date(t.getFullYear(),t.getMonth(),1).getDay()}}),e.get("Datepicker")});